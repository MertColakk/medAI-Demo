#!/bin/bash
minikube delete && minikube start --memory=3000 --cpus=4 --addons=ingress,metrics-server --cni=cilium 
kubectl config set-context --current --namespace=xray-api && eval $(minikube docker-env) && docker build -t py-api:0.0.1 app/worker/ && docker build -t py-api-mng:0.0.1 app/worker-api-out/ && kubectl apply -f k8s/container && kubectl apply -f k8s/database && kubectl apply -f k8s/python && kubectl apply -f k8s/python-manager
minikube delete && minikube start --memory=3000 --cpus=4 --addons=ingress,metrics-server --cni=cilium && kubectl create namespace xray-api && kubectl config set-context --current --namespace=xray-api 
eval $(minikube docker-env) && docker build -t py-api:0.0.1 app/worker/ && docker build -t py-api-mng:0.0.1 app/worker-api-out/ && kubectl apply -f k8s/database/00-db-config.yaml && kubectl apply -f k8s/database/01-db-secrets.yaml && kubectl apply -f k8s/database/02-db-stateful.yaml && kubectl apply -f k8s/database/03-db-svc.yaml && kubectl apply -f k8s/database/04-db-svc-hl.yaml && kubectl apply -f k8s/database/05-db-init-cfg.yaml && kubectl apply -f k8s/database/06-db-init-job.yaml && kubectl apply -f k8s/python-manager/00-python-gateway-cfg.yaml && kubectl apply -f k8s/python-manager/01-python-api-svc.yaml && kubectl apply -f k8s/python-manager/02-python-api-dep.yaml && kubectl apply -f k8s/python/00-python-api-cfg.yaml && kubectl apply -f k8s/python/01-python-api-svc.yaml && kubectl apply -f k8s/python/02-python-api-dep.yaml && kubectl apply -f k8s/container/00-rq-lr.yaml && kubectl apply -f k8s/container/01-hpa.yaml